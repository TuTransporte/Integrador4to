@using System.Data;
@model DataTable
@{
    ViewBag.Title = "PendientesDatos";
    Layout = "~/Views/Shared/MasterAdministracion.cshtml";
}

@foreach (DataRow row in Model.Rows)
{
    <center><h2 class="category">Gestión de denuncias pendientes</h2></center>

    <div class="row">
        <div class="col-md-1"></div>
        <div class="col-md-10">
            <div class="card">
                <div class="header">
                    <h4 class="title">Información de denuncia</h4>
                    <p class="category"></p>
                </div>
                <div class="content">
                    @using (Html.BeginForm("ApDenuncia", "Administracion", FormMethod.Post))
                    {
                        <input value="@row["Id"]" id="txtId" name="txtId" type="text" class="form-control" style="visibility:hidden;" />
                        <input value="@row["Estado"]" id="txtEst" name="txtEst" type="text" class="form-control" style="visibility:hidden;" />
                        <input value="@row["Latitud"]" id="txtLatitud" name="txtLatitud" type="text" class="form-control" style="visibility:hidden;" />
                        <input value="@row["Longitud"]" id="txtLongitud" name="txtLongitud" type="text" class="form-control" style="visibility:hidden;" />
                        <div class="panel panel-info">
                            <!-- Default panel contents -->
                            <div class="panel-heading"><label>Denuncia</label></div>
                            <div class="panel-body">
                                <h5>Fecha y hora</h5>
                                <input value="@row["FechaHora"]" id="txtSerie" name="txtSerie" type="text" class="form-control" placeholder="Nombre(s) del empleado">
                                <h5>Descripción</h5>
                                <textarea id="txtSerie" name="txtSerie" type="text" class="form-control" style="resize:unset;">@row["Denuncia"]</textarea>
                            </div>
                            <div class="panel-body">
                                <div id="map" style="height: 500px"></div>
                            </div>
                            <div class="panel-body">
                                <h5>Imagen</h5>
                                <center><img src="data:;base64,@row["Imagen"]" width="250px" class="thumbnail" onerror="this.src = '/Content/MasterResources/assets/img/faces/default.jpg';" /></center>
                            </div>
                            <!-- List group -->
                            <ul class="list-group"></ul>
                            <div class="list-group">
                                <br />
                                <center>
                                    <a href="/Administracion/Pendientes" class="btn btn-danger">Cancelar</a>
                                    <button type="submit" class="btn btn-info">Finalizar</button>
                                </center>
                                <br />
                            </div>
                        </div>
                    }
                    <div class="footer">
                        <div class="legend">
                        </div>
                        <hr>
                        <div class="stats">
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-1"></div>
    </div>
}

<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCfyDDJAmflpCHz6luQoOTPsn38JinRq3w&libraries=drawing&callback=initialize" async defer></script>

<script>
    function initialize() {

        var lat = txtLatitud.value;
        var long = txtLongitud.value;
        var mapProp = {
            center: new google.maps.LatLng(20.98010396916269, -89.63291830000009),
                zoom: 13,
                mapTypeId: google.maps.MapTypeId.ROADMAP
            };

            var map = new google.maps.Map(document.getElementById("map"), mapProp);
            var myTrip = new Array();
            @Html.Raw(ViewBag.Markers);
            //myTrip.push(new google.maps.LatLng(20.959867, -89.582616));
            //myTrip.push(new google.maps.LatLng(20.957006, -89.570954));
            //myTrip.push(new google.maps.LatLng(20.964634, -89.569409));
            var flightPath = new google.maps.Polyline({
                path: myTrip,
                strokeColor: "#0000FF",
                strokeOpacity: 0.8,
                strokeWeight: 2
            });
            flightPath.setMap(map);
            //Estos metodos colocan latitud y longitud del marcador en los cuadros de texto, asi como sus nuevas ubicaciones si son movidos.

            var markerA = new google.maps.Marker({
                map: map,
                position: new google.maps.LatLng(lat, long),
                icon: 'http://maps.google.com/mapfiles/ms/icons/green-dot.png',
                draggable: true,
                customInfo: "Marker A"
            });

            google.maps.event.addListener(markerA, 'click', function (overlay, point) {
                document.getElementById("latbox").value = lat();
                document.getElementById("lngbox").value = lng();
            });
            google.maps.event.addListener(markerA, 'click', function (event) {
                document.getElementById("latbox").value = event.latLng.lat();
                document.getElementById("lngbox").value = event.latLng.lng();
            });

            google.maps.event.addListener(markerA, 'click', function (event) {
                document.getElementById("latbox").value = this.getPosition().lat();
                document.getElementById("lngbox").value = this.getPosition().lng();
            });

            google.maps.event.addListener(markerA, 'dragend', function (event) {
                document.getElementById("latbox").value = this.getPosition().lat();
                document.getElementById("lngbox").value = this.getPosition().lng();
            });

            //Fin Metodo

        }
        google.maps.event.addDomListener(window, 'load', initialize);
</script>
